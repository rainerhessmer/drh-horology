(function(){function o(o){function n(o,e,n){return f.pan.iPos=f.pan.fPos,f.transform=u.transform(),f.transform.x=o,f.transform.y=e,"number"==typeof n?f.zoom(n):a(),f}function t(e,t,r,s){if(!(e>o.zoom[1]||e<o.zoom[0])){if(1===arguments.length)return f.transform=f.transform||u.transform(),f.transform.scaleY=f.transform.scaleX=e,a(),f;var m=f.transform||u.transform(),i=m.x,l=m.y,p=e/m.scaleX,c=p*(i-t)+t,d=p*(l-r)+r;n(c,d,e),s&&u.node.dispatchEvent(new CustomEvent("zoom",{detail:{e:s,tr:m}}))}}function a(){u.attr("transform","matrix("+[f.transform.scaleX,0,0,f.transform.scaleY,f.transform.x,f.transform.y].join(",")+")")}function r(o){if(f.pan.mousedown){var e=f.transform=u.transform(),n=f.pan.fPos.x-f.pan.iPos.x,t=f.pan.fPos.y-f.pan.iPos.y;f.setPosition(e.x+n,e.y+t),u.node.dispatchEvent(new CustomEvent("pan",{detail:{e:o,tr:e}}))}}function s(o,e){var n=u.parent().node.getBoundingClientRect(),t={x:o.clientX||o.touches[0].pageX,y:o.clientY||o.touches[0].pageY};return e?{x:t.x-n.left,y:t.y-n.top}:t}function m(e){var n=s(e,!0),a=n.x,r=n.y;e.deltaY=e.deltaY||e.wheelDeltaY||-e.wheelDelta;var m=o.zoomSpeed*e.deltaY/1e3,i=f.transform=u.transform(),l=i.scaleX+i.scaleX*m;t(l,a,r,e),e.preventDefault()}var u=this,f={pan:{},elm:u,setPosition:n,zoom:t};o=Object(o),o.zoom=o.zoom||[],o.zoomSpeed="number"==typeof o.zoomSpeed?o.zoomSpeed:-1;for(var i=u;"SVG"!==(i=u.parent()).node.tagName.toUpperCase(););var l=new SVG(document.createDocumentFragment()).rect().attr({width:i.width(),height:i.height(),fill:"none"}).style("pointer-events","all");u.parent().node.insertBefore(l.node,u.node);var p={mouse_down:function(o){f.pan.mousedown=!0,f.pan.iPos=s(o)},mouse_up:function(o){f.pan.mousedown=!1,f.pan.fPos=s(o),r()},mouse_move:function(o){f.pan.mousedown&&(f.pan.fPos=s(o),r())},mouse_leave:function(o){f.pan.mousedown=!1}};return l.on(e,m).on("mousedown",p.mouse_down).on("touchstart",p.mouse_down).on("mousemove",p.mouse_move).on("touchmove",p.mouse_move).on("mouseup",p.mouse_up).on("touchup",p.mouse_up).on("mouseleave",p.mouse_leave),u.on(e,m),f}var e="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";SVG.extend(SVG.Element,{panZoom:o})}).call(this);